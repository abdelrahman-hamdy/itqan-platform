<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš« Block allUrl.js - Upload Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f0f8ff; 
        }
        .warning { 
            background: #ffe6e6; 
            border: 2px solid #ff0000; 
            padding: 20px; 
            border-radius: 8px; 
            margin: 20px 0; 
        }
        .success { 
            background: #e6ffe6; 
            border: 2px solid #00aa00; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 10px 0; 
        }
        .instructions { 
            background: #fff3cd; 
            border: 1px solid #ffeaa7; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 15px 0; 
        }
        pre { 
            background: #f8f8f8; 
            padding: 10px; 
            border-radius: 5px; 
            font-size: 12px; 
            overflow-x: auto; 
        }
        .button {
            background: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
    </style>
    <script>
        console.log('ğŸš« Blocking allUrl.js initialization...');
        
        // Block allUrl.js by overriding common injection methods
        const originalAppendChild = Element.prototype.appendChild;
        const originalInsertBefore = Element.prototype.insertBefore;
        
        Element.prototype.appendChild = function(element) {
            if (element.tagName === 'SCRIPT' && element.src && element.src.includes('allUrl')) {
                console.error('ğŸš« BLOCKED allUrl.js injection attempt:', element.src);
                return element;
            }
            return originalAppendChild.call(this, element);
        };
        
        Element.prototype.insertBefore = function(element, beforeElement) {
            if (element.tagName === 'SCRIPT' && element.src && element.src.includes('allUrl')) {
                console.error('ğŸš« BLOCKED allUrl.js injection attempt:', element.src);
                return element;
            }
            return originalInsertBefore.call(this, element, beforeElement);
        };

        // Block dynamic script loading
        const originalCreateElement = document.createElement;
        document.createElement = function(tagName) {
            const element = originalCreateElement.call(this, tagName);
            if (tagName.toLowerCase() === 'script') {
                const originalSrcSetter = Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype, 'src').set;
                Object.defineProperty(element, 'src', {
                    set: function(value) {
                        if (value && value.includes('allUrl')) {
                            console.error('ğŸš« BLOCKED allUrl.js dynamic loading:', value);
                            return;
                        }
                        originalSrcSetter.call(this, value);
                    },
                    get: function() {
                        return this.getAttribute('src');
                    }
                });
            }
            return element;
        };

        // Monitor fetch requests and block allUrl-related ones
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            const url = args[0];
            if (url && (url.includes('allUrl') || (typeof url === 'string' && url.match(/allUrl/i)))) {
                console.error('ğŸš« BLOCKED fetch request to allUrl:', url);
                return Promise.reject(new Error('Blocked allUrl request'));
            }
            return originalFetch.apply(this, args);
        };

        // Block XMLHttpRequest to allUrl
        const originalXHROpen = XMLHttpRequest.prototype.open;
        XMLHttpRequest.prototype.open = function(method, url, ...rest) {
            if (url && (url.includes('allUrl') || url.match(/allUrl/i))) {
                console.error('ğŸš« BLOCKED XHR request to allUrl:', url);
                throw new Error('Blocked allUrl request');
            }
            return originalXHROpen.call(this, method, url, ...rest);
        };

        // Monitor and identify the injection source
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList') {
                    mutation.addedNodes.forEach(function(node) {
                        if (node.tagName === 'SCRIPT') {
                            if (node.src && node.src.includes('allUrl')) {
                                console.error('ğŸš« Detected allUrl.js injection attempt via DOM mutation');
                                console.error('Script element:', node);
                                console.error('Parent element:', node.parentElement);
                                node.remove();
                            }
                        }
                    });
                }
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            observer.observe(document.body, { childList: true, subtree: true });
            console.log('âœ… allUrl.js blocking is active');
            
            // Test if blocking is working
            setTimeout(() => {
                console.log('ğŸ§ª Testing allUrl.js blocking...');
                try {
                    const testScript = document.createElement('script');
                    testScript.src = 'https://example.com/allUrl.js';
                    document.head.appendChild(testScript);
                    console.log('âŒ Block test failed - script was added');
                } catch (e) {
                    console.log('âœ… Block test passed - script was blocked');
                }
            }, 1000);
        });

        // Global error handler to catch any remaining allUrl errors
        window.addEventListener('error', function(e) {
            if (e.filename && e.filename.includes('allUrl')) {
                console.error('ğŸš« Caught allUrl.js error:', e);
                e.preventDefault();
                return false;
            }
        });

        console.log('ğŸ›¡ï¸ allUrl.js protection initialized');
    </script>
</head>
<body>
    <h1>ğŸš« allUrl.js Blocker - Video Upload Test</h1>
    
    <div class="warning">
        <h2>âš ï¸ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</h2>
        <p><strong>allUrl.js</strong> ÙŠØªÙ… Ø­Ù‚Ù†Ù‡ Ù…Ù† Ù…ØµØ¯Ø± Ø®Ø§Ø±Ø¬ÙŠ ÙˆÙŠÙ…Ù†Ø¹ Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø¥Ø¬Ø±Ø§Ø¡ Ø·Ù„Ø¨Ø§Øª HEAD Ø¥Ù„Ù‰ blob URLs</p>
    </div>
    
    <div class="success">
        <h2>âœ… Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ø¤Ù‚Øª</h2>
        <p>Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØªØ­Ø¬Ø¨ allUrl.js ÙˆÙ…Ø­Ø§ÙˆÙ„Ø§Øª Ø­Ù‚Ù†Ù‡ ÙÙŠ Ø§Ù„ØµÙØ­Ø©</p>
    </div>
    
    <div class="instructions">
        <h2>ğŸ“‹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª:</h2>
        <ol>
            <li>Ø§ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± (F12) ÙˆØ§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Console</li>
            <li>ÙŠØ¬Ø¨ Ø£Ù† ØªØ´Ø§Ù‡Ø¯ Ø±Ø³Ø§Ø¦Ù„ ØªØ¨Ø¯Ø£ Ø¨Ù€ ğŸ›¡ï¸ Ùˆ âœ…</li>
            <li>Ø§Ù†ØªÙ‚Ù„ Ø§Ù„Ø¢Ù† Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø±ÙØ¹ Ø§Ù„Ø¯ÙˆØ±Ø©</li>
            <li>Ø¬Ø±Ø¨ Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ</li>
            <li>Ø±Ø§Ù‚Ø¨ Console Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø¬Ø¨ allUrl.js</li>
        </ol>
    </div>

    <div class="instructions" style="background: #e8f5e9; border-color: #4caf50;">
        <h2>ğŸ” Ù…ØµØ§Ø¯Ø± Ù…Ø­ØªÙ…Ù„Ø© Ù„Ù€ allUrl.js:</h2>
        <ul>
            <li><strong>Ù…Ø²ÙˆØ¯ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª (ISP)</strong> - ÙŠØ­Ù‚Ù† Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø£Ùˆ ØªØªØ¨Ø¹</li>
            <li><strong>Ø®Ø¯Ù…Ø© CDN Ø£Ùˆ Analytics</strong> - Google Analytics, Facebook Pixel, Ø¥Ù„Ø®</li>
            <li><strong>Proxy Ø£Ùˆ Firewall</strong> - Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø´Ø¨ÙƒØ©</li>
            <li><strong>Ø®Ø¯Ù…Ø© Hosting</strong> - Ø¨Ø¹Ø¶ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø§Ø³ØªØ¶Ø§ÙØ© ØªØ­Ù‚Ù† Ø³ÙƒØ±ÙŠØ¨ØªØ§Øª</li>
            <li><strong>Router Ø£Ùˆ Network Equipment</strong> - Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©</li>
        </ul>
    </div>

    <button class="button" onclick="window.open('/admin/recorded-courses/create', '_blank')">
        ğŸ¬ ÙØªØ­ ØµÙØ­Ø© Ø±ÙØ¹ Ø§Ù„Ø¯ÙˆØ±Ø©
    </button>
    
    <button class="button" onclick="location.reload()">
        ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    </button>

    <div style="margin-top: 30px;">
        <h3>ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©:</h3>
        <pre id="network-info"></pre>
    </div>

    <script>
        // Display network information
        document.getElementById('network-info').textContent = JSON.stringify({
            userAgent: navigator.userAgent,
            domain: window.location.hostname,
            protocol: window.location.protocol,
            referrer: document.referrer,
            cookies: document.cookie.substring(0, 200) + '...',
            timestamp: new Date().toISOString()
        }, null, 2);
    </script>
</body>
</html>
